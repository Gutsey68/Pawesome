@model Pawesome.Models.ViewModels.Dashboard.DashboardViewModel

@{
    ViewData["Title"] = "Tableau de bord";
}

<main role="main">
    <div class="dashboard-page">
        <div class="dashboard-header">
            <h1>Tableau de bord</h1>
            <p>Trouvez rapidement ce que vous cherchez</p>
        </div>
        <div class="dashboard-search-container">
            <div class="tabs-container">
                <div class="tabs-list" role="tablist">
                    <button class="tab active" role="tab" aria-selected="true" data-role="petsitter">Je cherche un pet-sitter</button>
                    <button class="tab" role="tab" aria-selected="false" data-role="looking">Je suis pet-sitter</button>
                </div>
            </div>
            <form id="searchForm" method="get" asp-controller="Advert" asp-action="Index">
                <input type="hidden" id="isPetSitter" name="isPetSitter" value="false">
                <input type="hidden" id="IsPetSitterOffer" name="IsPetSitterOffer" value="false">
                <div class="dashboard-research-bar">
                    <div class="search-inputs-container">
                        <div class="date-input-container">
                            <label for="start-date">Date de début</label>
                            <input type="date" id="start-date" name="StartDateFrom" class="research-bar-date-start" placeholder="Date de début" value="@Model.StartDate.ToString("yyyy-MM-dd")"/>
                        </div>
                        <span class="tiny-separator"></span>
                        <div class="date-input-container">
                            <label for="end-date">Date de fin</label>
                            <input type="date" id="end-date" name="EndDateTo" placeholder="Date de fin" value="@Model.EndDate.ToString("yyyy-MM-dd")"/>
                        </div>
                        <span class="tiny-separator"></span>
                        <div class="location-input-container">
                            <label for="location">Ville</label>
                            <input type="text" id="location" name="City" placeholder="Paris, Lyon..."/>
                        </div>
                        <button class="research-button" type="submit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-icon lucide-search"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <section class="dashboard-section">
            <h2>Réservations en attente (@(ViewBag.PendingBookings != null ? ViewBag.PendingBookings.Count : 0))</h2>
            <div class="pending-bookings">
                @if (ViewBag.PendingBookings != null && ViewBag.PendingBookings.Count > 0)
                {
                    <div class="bookings-list">
                        @foreach (var booking in ViewBag.PendingBookings)
                        {
                            <div class="booking-item">
                                <div class="booking-details">
                                    <span class="booking-dates">Du @booking.StartDate.ToString("dd/MM/yyyy") au @booking.EndDate.ToString("dd/MM/yyyy")</span>
                                    <span class="booking-price">@booking.Amount.ToString("C")</span>
                                </div>
                                <div class="booking-actions">
                                    <a asp-controller="Booking" asp-action="Details" asp-route-id="@booking.Id" class="btn btn-outline-primary btn-sm">Voir détails</a>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p>Aucune réservation en attente.</p>
                }
            </div>
        </section>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tabs = document.querySelectorAll('.tab');
        const isPetSitterInput = document.getElementById('isPetSitter');
        const isPetSitterOfferInput = document.getElementById('IsPetSitterOffer');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                tabs.forEach(t => {
                    t.classList.remove('active');
                    t.setAttribute('aria-selected', 'false');
                });
                this.classList.add('active');
                this.setAttribute('aria-selected', 'true');

                if (this.dataset.role === 'looking') {
                    isPetSitterInput.value = 'true';
                    isPetSitterOfferInput.value = 'true';
                } else {
                    isPetSitterInput.value = 'false';
                    isPetSitterOfferInput.value = 'false';
                }
            });
        });
    });
</script>
