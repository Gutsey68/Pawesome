@using System.Globalization
@model Pawesome.Models.Dtos.Advert.PetSittingAdvertDto

<div class="container">
    <div class="card">
        <div class="card-header">
            <h1>@(Model.IsPetSitter ? "Offre de pet sitting" : "Demande de pet sitting")</h1>
        </div>
        <div class="card-body">
            <div>
                <div>
                    <h3>Détails</h3>
                    <dl>
                        <dt>Date de début</dt>
                        <dd>@Model.StartDate.ToString("dd/MM/yyyy")</dd>
                        <dt>Date de fin</dt>
                        <dd>@Model.EndDate.ToString("dd/MM/yyyy")</dd>
                        <dt>Montant</dt>
                        <dd>@Model.Amount €</dd>
                        <dt>Statut</dt>
                        <dd>@Model.Status</dd>
                        @if (!string.IsNullOrEmpty(Model.AdditionalInformation))
                        {
                            <dt>Détails de l'annonce</dt>
                            <dd>@Model.AdditionalInformation</dd>
                        }
                    </dl>
                </div>
                <div>
                    @if (Model.IsPetSitter)
                    {
                        <h3>Types d'animaux acceptés</h3>
                        <div>
                            @foreach (var pet in Model.PetCartViewModels)
                            {
                                <div>
                                    <div>
                                        <h4>@pet.Species</h4>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <h3>Animaux à garder</h3>
                        <div>
                            @foreach (var pet in Model.PetCartViewModels)
                            {
                                <div>
                                    @if (!string.IsNullOrEmpty(pet.Photo))
                                    {
                                        <img src="~/images/pets/@pet.Photo" alt="@pet.Name" class="pet-thumbnail">
                                    }
                                    <div>
                                        <h4>@pet.Name</h4>
                                        <p>@pet.Species</p>
                                    </div>
                                </div>
                            }
                        </div>
                        
                    }
                </div>
            </div>
            <div>
                <div>
                    <h3>Contact</h3>
                    @if (Model.Owner != null)
                    {
                        <div>
                            @if (!string.IsNullOrEmpty(Model.Owner.Photo))
                            {
                                <img src="@Model.Owner.Photo" alt="Photo profil">
                            }
                            <div>
                                <h4>@Model.Owner.FullName </h4>
                                <p>Note : @Model.Owner.Rating/5</p>
                                <a asp-controller="User" asp-action="Profile" asp-route-id="@Model.Owner.Id" class="button secondary">Voir le profil</a>
                            </div>
                        </div>
                    }
                </div>
            </div>
            @if (User.Identity?.IsAuthenticated == true && Model.Owner != null && 
                 User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value != Model.Owner.Id.ToString() &&
                 Model.Status == "pending" || Model.Status == "pending_offer")
            {
                <div class="card">
                    <div class="card-header">
                        <h5>Réserver ce service</h5>
                    </div>
                    <div class="card-body">
                        <p>Prix: @Model.Amount.ToString("C", new CultureInfo("fr-FR"))</p>
                        <a asp-controller="Payment" asp-action="Checkout" asp-route-advertId="@Model.Id" 
                           class="button">
                            Réserver maintenant
                        </a>
                    </div>
                </div>
            }
            @if (User.Identity?.IsAuthenticated == true && Model.Owner != null && User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value == Model.Owner.Id.ToString())
            {
                <div>
                    <div>
                        <h3>Actions</h3>
                        <div>
                            @if (Model.IsPetSitter)
                            {
                                <a asp-action="EditOffer" asp-route-id="@Model.Id" class="button primary">Modifier mon offre</a>
                            }
                            else
                            {
                                <a asp-action="EditRequest" asp-route-id="@Model.Id" class="button primary">Modifier ma demande</a>
                            }

                            @if (Model.Status == "pending" || Model.Status == "pending_offer")
                            {
                                <form asp-action="UpdateStatus" method="post">
                                    <input type="hidden" name="advertId" value="@Model.Id" />
                                    <input type="hidden" name="status" value="canceled" />
                                    <button type="submit" class="button">Annuler mon annonce</button>
                                </form>
                            }
                            <a asp-action="Delete" asp-route-id="@Model.Id" class="button danger">Supprimer</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
