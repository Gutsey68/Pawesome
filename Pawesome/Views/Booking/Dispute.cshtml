@{
    ViewData["Title"] = "Signaler un problème";
    var bookingId = ViewBag.BookingId;
}

<div class="container dispute-container">
    <div class="dispute-header">
        <h1>Signaler un problème avec cette prestation</h1>
    </div>
    
    <div class="dispute-card">
        <div class="alert" data-variant="warning">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                <path d="M12 9v4"></path>
                <path d="M12 17h.01"></path>
            </svg>
            <div>
                <h3>Important</h3>
                <p>L'ouverture d'un litige suspend temporairement le paiement et déclenche une procédure de médiation. Veuillez fournir des explications précises du problème rencontré.</p>
            </div>
        </div>
        
        <form asp-action="Dispute" method="post">
            <input type="hidden" name="bookingId" value="@bookingId" />
            
            <div class="form-group">
                <label for="reason">Motif du litige</label>
                <textarea id="reason" name="reason" class="form-control" rows="6" required placeholder="Décrivez en détail les raisons pour lesquelles vous souhaitez contester cette prestation..."></textarea>
                <div class="form-hint">Minimum 20 caractères, soyez aussi précis et factuel que possible</div>
                @if (ViewData.ModelState?[""]?.Errors?.Count > 0)
                {
                    <span class="validation-message">@ViewData.ModelState[""]?.Errors.First().ErrorMessage</span>
                }
            </div>
            
            <div class="form-actions">
                <a asp-action="Details" asp-route-id="@bookingId" class="button" data-variant="outline">Annuler</a>
                <button type="submit" class="button" data-variant="warning">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg>
                    Soumettre le litige
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const reasonTextarea = document.getElementById('reason');
            const submitButton = document.querySelector('button[type="submit"]');
            
            reasonTextarea.addEventListener('input', function () {
                if (reasonTextarea.value.length < 20) {
                    submitButton.disabled = true;
                } else {
                    submitButton.disabled = false;
                }
            });
            
            submitButton.disabled = true;
        });
    </script>
}